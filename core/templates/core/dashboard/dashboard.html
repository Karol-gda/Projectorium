{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container-fluid">
  <div class="row">
    <nav class="col-md-2 bg-light sidebar py-3">
      <ul class="nav flex-column">
        <li class="nav-item"><a class="nav-link" href="{% url 'dashboard' %}">Dashboard</a></li>
        <li class="nav-item"><a class="nav-link" href="{% url 'my-projects' %}">Moje projekty</a></li>
        <li class="nav-item"><a class="nav-link" href="{% url 'my-tasks' %}">Moje zadania</a></li>
        <li class="nav-item"><a class="nav-link" href="{% url 'my-changelogs' %}">Moje zgłoszenia</a></li>
        <li class="nav-item"><a class="nav-link" href="{% url 'calendar' %}">Mój kalendarz</a></li>
      </ul>
    </nav>

    <main class="col-md-10 px-4">
      <h2 class="mt-4">Witaj {{ request.user.first_name }}!</h2>

      <div class="card my-4">
        <div class="card-body">
          <h4 class="card-title">Aktywne projekty: {{ project_count }}</h4>
        </div>
      </div>

      <div class="card my-4">
        <div class="card-header">Twoje projekty</div>
        <div class="card-body">
          {% if projects %}
          <table class="table table-sm">
            <thead><tr><th>Nazwa</th><th>Termin</th><th>Rola</th></tr></thead>
            <tbody>
              {% for item in projects %}
              <tr>
                <td>{{ item.project.title }}</td>
                <td>{{ item.project.end_date|date:"d.m.Y" }}</td>
                <td>{{ item.role }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          {% else %}
          <p>Brak projektów</p>
          {% endif %}
          <div class="mt-3">
            <a href="{% url 'my-projects' %}" class="btn btn-sm btn-outline-primary">Moje projekty</a>
            <a href="{% url 'join-project' %}" class="btn btn-sm btn-outline-success">Dołącz do projektu</a>
            <a href="{% url 'create-project' %}" class="btn btn-sm btn-outline-secondary">Dodaj projekt</a>
          </div>
        </div>
      </div>

      <div class="card my-4">
        <div class="card-header">Zadania do wykonania (w ciągu 7 dni)</div>
        <ul class="list-group list-group-flush">
          {% for task in upcoming_tasks %}
          <li class="list-group-item">
            <strong>{{ task.title }}</strong> – {{ task.project.name }}<br>
            Termin: {{ task.due_date|date:"d.m.Y" }}
          </li>
          {% empty %}
          <li class="list-group-item">Brak zadań</li>
          {% endfor %}
        </ul>
      </div>

      <div class="card my-4">
        <div class="card-header">Zgłoszenia zmian</div>
        <ul class="list-group list-group-flush">
          {% for change in recent_changelogs %}
          <li class="list-group-item">
            <strong>{{ change.title }}</strong> – {{ change.project.name }}<br>
            Status: {{ change.get_status_display }}<br>
            Data: {{ change.created_at|date:"d.m.Y" }}
          </li>
          {% empty %}
          <li class="list-group-item">Brak zgłoszeń</li>
          {% endfor %}
        </ul>
      </div>
    </main>
  </div>
</div>
{% endblock %}
